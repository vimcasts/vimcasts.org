--- 
:title: Search for the selected text
:date: 2013/03/25
:poster: /images/posters/visual_star.png
:flattr_id: "1204601"
:duration: 279
:number: 46
:tags: search, Regular expressions, Vimscript, plugins, Visual mode, Customizing Vim, vimgrep
---

[The `*` command][star] searches for the word under the cursor. That makes sense in Normal mode, but from Visual mode it would be more useful if the star command searched for the current *selection*, rather than the current word. We can add this feature to Vim using the [visual star search plugin][visual-star].

[visual-star]: https://github.com/nelstrom/vim-visual-star-search
[star]: http://vimdoc.sourceforge.net/htmldoc/pattern.html#star


READMORE


Look up [`:help visual-search`][vs] in Vim's documentation, and you'll find a suggestion for this simple mapping:

```viml
:vmap X y/<C-R>"<CR>
```

This comes with a warning: **Note that special characters (like `.` and `*`) will cause problems.** It's not too hard to avoid these problems. This snippet of code takes care of them:

```viml
function! s:VSetSearch(cmdtype)
  let temp = @s
  norm! gv"sy
  let @/ = '\V' . substitute(escape(@s, a:cmdtype.'\'), '\n', '\\n', 'g')
  let @s = temp
endfunction

xnoremap * :<C-u>call <SID>VSetSearch('/')<CR>/<C-R>=@/<CR><CR>
xnoremap # :<C-u>call <SID>VSetSearch('?')<CR>?<C-R>=@/<CR><CR>
```

You install the [visual-star-search][] plugin from github, which wraps up this functionality.

Note that these visual mode `*` and `#` mappings create a new record in Vim's search history. You can always paste the last search pattern by pressing [`<C-r>/`][cr], so you can easily search through multiple files using `:vimgrep`:

    :vimgrep /<C-r>//g **

Naturally, the patterns generated by these `*` and `#` mappings can also be used with any Ex command that accepts a pattern, including `:substitute`, `:global`, and `:vimgrep`.

### Further reading

* [visual-star-search][] plugin
* [`:help visual-search`][vs]
* [`:help quote/`][quote/]
* [`:help c_CTRL-R`][cr]
* [Practical Vim][pv] tip 86 - Search for the current visual selection
* [Practical Vim][pv] tip 78 - Escape Problem Characters
* [Vim pr0n: Visual search mappings][pr0n]

[pv]: https://pragprog.com/titles/dnvim2/practical-vim-second-edition
[cr]: http://vimdoc.sourceforge.net/htmldoc/cmdline.html#c_CTRL-R
[quote/]: http://vimdoc.sourceforge.net/htmldoc/change.html#quote/
[visual-star-search]: https://github.com/nelstrom/vim-visual-star-search
[vs]: http://vimdoc.sourceforge.net/htmldoc/visual.html#visual-search
[pr0n]: http://got-ravings.blogspot.co.uk/2008/07/vim-pr0n-visual-search-mappings.html
